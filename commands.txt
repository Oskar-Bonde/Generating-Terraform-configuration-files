Commandline cloud
# setup
pip install -r requirements.txt --user
pip install torch==1.9.0+cu111 torchvision==0.10.0+cu111 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html
pip uninstall setuptools
python3 -m pip install setuptools==59.5.0
accelerate config
nvidia-smi 

# remove dir
rm -r cloud-codeparrot

# find process
ps -x

# save model
gcloud auth login
zip -r txt-data.zip data
gsutil cp /home/oskar_bonde/cloud-codeparrot/models/model-2.zip gs://terraform-models 
gsutil cp /home/oskar_bonde_ericsson_com/codeparrot.zip gs://terraform-models 
gsutil cp gs://terraform-models/codeparrot.zip /home/oskar_bonde/
gsutil cp /home/oskar_bonde/cloud-codeparrot/gpt-2-small-data.zip gs://terraform-models 

# codeparrot small
nohup accelerate launch codeparrot_training.py --save_dir ./models/model-2 --learning_rate 5e-5

# codeparrot large training
nohup accelerate launch codeparrot_training.py --model_ckpt lvwerra/codeparrot --save_dir ./models/model-3 --learning_rate 2e-5 --num_warmup_steps 750 --gradient_accumulation_steps 16 --gradient_checkpointing True --train_batch_size 2 --valid_batch_size 2

# gpt-2-large
nohup accelerate launch codeparrot_training.py --model_ckpt gpt2-large --save_dir ./models/model-4 --learning_rate 2e-5 --num_warmup_steps 750 --gradient_accumulation_steps 16 --gradient_checkpointing True --train_batch_size 2 --valid_batch_size 2

# gpt-2-small
nohup accelerate launch codeparrot_training.py --model_ckpt gpt2 --save_dir ./models/model-5 --learning_rate 5e-5 --train_batch_size 10 --valid_batch_size 10
