terraform {
  required_providers {
    google = {
      source = "hashicorp/google"
    }
  }
}

# google provider block 
provider "google" {
  credentials = file("${path.module}/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../
}

# create a CaPool resource
resource "google_privateca_certificate_authority" "ca" {
  provider = google-beta

  type = "SUBORDINATE"

  subordinate_config {
    issuer {
      type = "SELF_SIGNED"
    }
  }

  config {
    key_algorithm = "RSA_3072"
    key_usage {
      key_usage = "DIGITAL_SIGNATURE"
    }
    key_usage {
      key_usage = "KEY_ENCIPHERMENT"
    }
    key_usage {
      key_usage = "CERTIFICATE_SIGN"
    }
    key_usage {
      key_usage = "CRL_SIGN"
    }
    key_usage {
      key_usage = "KEY_CERT_SIGN"
    }
    lifetime {
      lifetime = "P1Y"
    }
    lifetime {
      lifetime = "P90D"
    }
    is_ca = true
    subject_config {
      subject {
        common_name = "example.com"
      }
    }
  }
}

