# raw-data/hashicorp-certified-terraform\11-Terraform-Cloud-and-Enterprise-Capabilities\11-03-Terraform-Cloud-CLI-Driven-Workflow\terraform-manifests
# Terraform Block with AWS. Set backend to hcta-demo1
terraform {
  required_version = "~> 0.14" 
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 3.0"
    }
  }
  backend "remote" {
    organization = "hcta-demo1"
    workspaces {
      name = "cli-driven-demo"
    }
  }
}

# Provider AWS with region set to var.aws_region
provider "aws" {
  region  = var.aws_region
}

# Create Variable for S3 Bucket Name called my_s3_bucket. Set defualt to mybucket-1051
variable "my_s3_bucket" {
  type = string
  default = "mybucket-1051"
}

# Create Variable for S3 Bucket Tags. Set default to Terraform = true, Environment = dev, newtag1 = tag1, newtag2 = tag2 and newtag3 = tag3
variable "my_s3_tags" {
  type = map(string)
  default = {
    Terraform = "true"
    Environment = "dev"
    newtag1 = "tag1"
    newtag2 = "tag2"
    newtag3 = "tag3"
  }
}

# Call moduel with source app.terraform.io/hcta-demo1/s3-website/aws
module "website_s3_bucket" {
  source  = "app.terraform.io/hcta-demo1/s3-website/aws"
  version = "1.0.1"
  # insert required variables here
  bucket_name = var.my_s3_bucket
  tags = var.my_s3_tags
}

# Output block: ARN of the S3 Bucket
output "arn" {
  value       = aws_s3_bucket.s3_bucket.arn
}

# Output block: Name (id) of the bucket
output "name" {
  value       = aws_s3_bucket.s3_bucket.id
}

# Output block: Domain Name of the bucket
output "domain" {
  value       = aws_s3_bucket.s3_bucket.website_domain
}

# Output block: Endpoint Information of the bucket
output "endpoint" {
  value       = aws_s3_bucket.s3_bucket.website_endpoint
}