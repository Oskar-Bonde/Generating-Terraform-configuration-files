# Terraform Block with AWS provider
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
    }
  }
}

# Provider Block AWS region var.aws_region
provider "aws" {
  region = var.aws_region
}

# Make AWS instance. Set ami to data.aws_ami.amzlinux.id, instance_type to var.instance_type, user data file apache-install.sh. Connection Block for Provisioners to connect to EC2 Instance. Copies the file-copy.html file to /tmp/file-copy.html. Make provisioner that copies the file to Apache Webserver /var/www/html directory
resource "aws_instance" "web" {
  ami           = data.aws_ami.amzlinux.id
  instance_type = var.instance_type
  user_data     = file("scripts/apache-install.sh")
  connection {
    type = "ssh"
    user = "ec2-user"
    private_key = file("/Users/david/.ssh/id_rsa")
  }
  provisioner "file" {
    source      = "file-copy.html"
    destination = "/tmp/file-copy.html"
  }
  provisioner "remote-exec" {
    inline = [
      "sudo yum install -y httpd",
      "sudo systemctl start httpd",
      "sudo systemctl enable httpd",
      "echo '<html><body><h1>Hello World</h1></body></html>' > /var/www/html/index.html",
      "echo 'Hello World!' > /tmp/hello-world.txt"
    ]
  }
}

