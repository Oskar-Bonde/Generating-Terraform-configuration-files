# raw-data/collabnix-course\beginners\aws\modules\s3
output "bucket_domain_name" {
  value = aws_s3_bucket.my_static_website_bucket.website_endpoint
}

output "this_s3_bucket_bucket_regional_domain_name" {
  description = "The bucket region-specific domain name. The bucket domain name including the region name, please refer here for format. Note: The AWS CloudFront allows specifying S3 region-specific endpoint when creating S3 origin, it will prevent redirect issues from CloudFront to S3 Origin URL."
  value       = aws_s3_bucket.my_static_website_bucket.bucket_regional_domain_name
}


resource "aws_s3_bucket" "my_static_website_bucket" {
  bucket = var.s3_bucket_name
  acl    = "public-read"
  force_destroy = true

  tags = {
    project = "Collabnix"
    department = "Automation"
  }

  website {
    index_document = "index.html"
    error_document = "error.html"

    routing_rules = <<EOF
[{
    "Condition": {
        "KeyPrefixEquals": "docs/"
    },
    "Redirect": {
        "ReplaceKeyPrefixWith": "documents/"
    }
}]
EOF
  }
  provisioner "local-exec" {
     command = "aws s3 cp ${var.document_directory} s3://${var.s3_bucket_name}/ --exclude \"*\" --include \"*.html\" --recursive --profile ${var.aws_profile_name} --acl public-read"
  }

}


variable "s3_bucket_name" {
   description =   "S3 Bucket Name"
   type        =   string
}

variable "aws_profile_name" {
   description =   "AWS Account profile name for local exec"
   type        =   string
}

variable "document_directory" {
   description =   "Directory where all S3 upload exist"
   type        =   string
}


