# raw-data/collabnix-course\beginners\gcp\vpc
resource "google_compute_firewall" "default" {
  name    = "firewall-vpc-network"
  network = google_compute_network.this.self_link

  allow {
    protocol = "tcp"
    ports    = var.ingress_ports
  }

  target_tags = ["http-server", "https-server"]
}

output "vpc_name" {
  value = google_compute_network.this.name
}

output "subnet_name" {
  value = google_compute_subnetwork.this.name
}


provider "google" {
  version = "~> 3.0.0"
  project = var.gcp_project_id
  region  = var.gcp_project_location
}


variable "gcp_project_id" {
  description = "This is a GCP Project id"
  type        = string
}

variable "gcp_project_location" {
  description = "This is a GCP Project id"
  type        = string
}

variable "ip_cidr_range" {
  description = "This is the cidr range for subnet"
  type        = string
}

variable "ingress_ports" {
  description = "This is the list of ports for vpc"
  type        = list(string)
}

variable "subnet_name" {
  description = "This is the name that subnet gets"
  type        = string
}

variable "vpc_name" {
  description = "This is the name that vpc gets"
  type        = string
}


resource "google_compute_network" "this" {
  name                    = var.vpc_name
  auto_create_subnetworks = false
}

resource "google_compute_subnetwork" "this" {
  name                     = var.subnet_name
  ip_cidr_range            = var.ip_cidr_range
  region                   = var.gcp_project_location
  network                  = google_compute_network.this.self_link
  private_ip_google_access = true
}


