terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
    }
  }
}

# Provider block with features block
provider "azurerm" {
  features {}
}

# create resource group, use name example-resources and set location to West Europe
resource "azurerm_resource_group" "example_resources" {
  name     = "example-resources"
  location = "westus"
}

# data block, azurem client config file, and terraform module
data "azurerm_client_config" "current" {}

# terraform module, custom domain, and terraform tfvars
module "tf_test" {
  source = "./tf-test"

  # tfvars
  tf_instance_type = "Standard_DS2_v2"
  tf_instance_name  = "tfinstance"
  tf_instance_display_name = "TFInstance"
  tf_instance_network_interface_ids = ["${azurerm_network_interface.tf_test_nic.id}"]
  tf_instance_storage_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "16.04-LTS"
    version   = "latest"
  }
  tf_instance_storage_os_disk {
    name          = "osdisk1"
    vhd_uri       = "${azurerm_storage_account.tf_test_storage_account.primary_blob_endpoint}${azurerm_storage_container.tf_test_container.name}/osdisk1.vhd"
    caching       = "ReadWrite"
    create_option = "FromImage"
  }
  tf_instance_storage_data_disk {
    name          = "datadisk1"
    vhd_uri       = "${azurerm_storage_account.tf_test_storage_account.primary_blob_endpoint}${azurerm_storage_container.tf_test_container.name}/datadisk1.vhd"
    disk_size_gb  = "1023"
    create_option = "Empty"
    lun           = 0
  }
  tf_instance_storage_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "16.04-LTS"
    version   = "latest"
  }
  tf_instance_storage_os_disk {
    name          = "osdisk2"
    vhd_uri       = "${azurerm_storage_account.tf_test_storage_account.primary_blob_endpoint}${azurerm_storage_container.tf_test_container.name}/osdisk2.vhd"
    disk_size_gb  = "1023"
    create_option = "Empty"
    lun           = 1
  }
  tf_instance_storage_data_disk {
    name          = "datadisk2"
    vhd_uri       = "${azurerm_storage_account.tf_test_storage_account.primary_blob_endpoint}${azurerm_storage_container.tf_test_container.name}/datadisk2.vhd"
    disk_size_gb  = "1023"
    create_option = "Empty"
    lun           = 1
  }
  # tfvars
  tf_instance_name = "tfinstance"
  tf_instance_network_interface_ids = ["${azurerm_network_interface.tf_test_nic.id}"]
  tf_instance_storage_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "16.04-LTS"
    version   = "latest"
  }
  tf_instance_storage_os_disk {
    name          = "osdisk3"
    vhd_uri       = "${azurerm_storage_account.tf_test_storage_account.primary_blob_endpoint}${azurerm_storage_container.tf_test_container.name}/osdisk3
}

